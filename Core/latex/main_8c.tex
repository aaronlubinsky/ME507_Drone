\doxysection{Src/main.c File Reference}
\hypertarget{main_8c}{}\label{main_8c}\index{Src/main.c@{Src/main.c}}


\+: Main program body for ME507 -\/ MECHA15 -\/ S25  


{\ttfamily \#include "{}main.\+h"{}}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include "{}BNO055.\+h"{}}\newline
{\ttfamily \#include "{}HC05.\+h"{}}\newline
{\ttfamily \#include "{}ESC.\+h"{}}\newline
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{main_8c_a1622abdaa5cd7ae05e6ae85331831c3f}\label{main_8c_a1622abdaa5cd7ae05e6ae85331831c3f} 
\#define {\bfseries PID\+\_\+\+SCALE}~100000
\item 
\Hypertarget{main_8c_a41f9c5fb8b08eb5dc3edce4dcb37fee7}\label{main_8c_a41f9c5fb8b08eb5dc3edce4dcb37fee7} 
\#define {\bfseries true}~1
\item 
\Hypertarget{main_8c_a65e9886d74aaee76545e83dd09011727}\label{main_8c_a65e9886d74aaee76545e83dd09011727} 
\#define {\bfseries false}~0
\item 
\Hypertarget{main_8c_a603153596d803651a6500a79d1c63473}\label{main_8c_a603153596d803651a6500a79d1c63473} 
\#define {\bfseries BT\+\_\+\+MSG\+\_\+\+LEN}~31
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{main_8c_a70af21c671abfcc773614a9a4f63d920}{System\+Clock\+\_\+\+Config}} (void)
\begin{DoxyCompactList}\small\item\em System Clock Configuration. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main}} (void)
\begin{DoxyCompactList}\small\item\em The application entry point. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_ae494a9643f29b87d6d81e5264e60e57b}{HAL\+\_\+\+UART\+\_\+\+Rx\+Cplt\+Callback}} (UART\+\_\+\+Handle\+Type\+Def \texorpdfstring{$\ast$}{*}huart)
\begin{DoxyCompactList}\small\item\em This callback function is triggered when UART2 (HC05 Stream) fills BT\+\_\+\+Rx\+Buf (Direct to Memory). It adds an end message statment, sends the buffer to the process\+Input function and sets the imu\+\_\+request flag. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{main_8c_abc513dd972081ae765b6949a62872eb7}{\+\_\+\+\_\+io\+\_\+putchar}} (int ch)
\begin{DoxyCompactList}\small\item\em This function is used to send printf() statments to the ST-\/\+Link UART. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_a1730ffe1e560465665eb47d9264826f9}{Error\+\_\+\+Handler}} (void)
\begin{DoxyCompactList}\small\item\em This function is executed in case of error occurrence. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{main_8c_af7b2c26e44dadaaa798a5c3d82914ba7}\label{main_8c_af7b2c26e44dadaaa798a5c3d82914ba7} 
I2\+C\+\_\+\+Handle\+Type\+Def {\bfseries hi2c1}
\item 
\Hypertarget{main_8c_a5ccf4a01a8d7f08d3190181f843f7515}\label{main_8c_a5ccf4a01a8d7f08d3190181f843f7515} 
I2\+C\+\_\+\+Handle\+Type\+Def {\bfseries hi2c3}
\item 
\Hypertarget{main_8c_aac3d2c59ee0e3bbae1b99529a154eb62}\label{main_8c_aac3d2c59ee0e3bbae1b99529a154eb62} 
TIM\+\_\+\+Handle\+Type\+Def {\bfseries htim3}
\item 
\Hypertarget{main_8c_a2cf715bef37f7e8ef385a30974a5f0d5}\label{main_8c_a2cf715bef37f7e8ef385a30974a5f0d5} 
UART\+\_\+\+Handle\+Type\+Def {\bfseries huart1}
\item 
\Hypertarget{main_8c_aa9479c261d65eecedd3d9582f7f0f89c}\label{main_8c_aa9479c261d65eecedd3d9582f7f0f89c} 
UART\+\_\+\+Handle\+Type\+Def {\bfseries huart2}
\item 
\Hypertarget{main_8c_a784aa25dc7e4580cfbf80658340f482c}\label{main_8c_a784aa25dc7e4580cfbf80658340f482c} 
DMA\+\_\+\+Handle\+Type\+Def {\bfseries hdma\+\_\+usart2\+\_\+rx}
\item 
\Hypertarget{main_8c_a9b6b56c45dac5e1804b4e36c4722f67b}\label{main_8c_a9b6b56c45dac5e1804b4e36c4722f67b} 
UART\+\_\+\+Handle\+Type\+Def \texorpdfstring{$\ast$}{*} {\bfseries BT\+\_\+\+UART\+\_\+ptr} = \&huart2
\item 
\Hypertarget{main_8c_a4fcbe303fd38925efbd6405696058c18}\label{main_8c_a4fcbe303fd38925efbd6405696058c18} 
UART\+\_\+\+Handle\+Type\+Def \texorpdfstring{$\ast$}{*} {\bfseries STLink\+\_\+\+UART\+\_\+ptr} = \&huart1
\item 
\Hypertarget{main_8c_a89f234133d3efe315836311cbf21c64b}\label{main_8c_a89f234133d3efe315836311cbf21c64b} 
int {\bfseries state} = 0
\item 
\Hypertarget{main_8c_a6b8a1e8a120cbda0010568da228ee55e}\label{main_8c_a6b8a1e8a120cbda0010568da228ee55e} 
volatile int {\bfseries imu\+\_\+request} = 0
\item 
\Hypertarget{main_8c_a2da65a4ed7e9c0b75aca343c56100616}\label{main_8c_a2da65a4ed7e9c0b75aca343c56100616} 
int32\+\_\+t {\bfseries roll\+\_\+set}
\item 
\Hypertarget{main_8c_a6988819caa7dacf7f337f8a22ca410a5}\label{main_8c_a6988819caa7dacf7f337f8a22ca410a5} 
int32\+\_\+t {\bfseries pitch\+\_\+set}
\item 
\Hypertarget{main_8c_aa423722cb5919dcaf8b9cac1977e7ed0}\label{main_8c_aa423722cb5919dcaf8b9cac1977e7ed0} 
int32\+\_\+t {\bfseries yaw\+\_\+set}
\item 
\Hypertarget{main_8c_a129a7f83022a1e63798a57f6391ff54c}\label{main_8c_a129a7f83022a1e63798a57f6391ff54c} 
int32\+\_\+t {\bfseries effort\+\_\+set}
\item 
\Hypertarget{main_8c_ae991616e2e1ca0f8a81bd57b96310be2}\label{main_8c_ae991616e2e1ca0f8a81bd57b96310be2} 
int32\+\_\+t {\bfseries roll\+\_\+true}
\item 
\Hypertarget{main_8c_ae955c88a2731a99e72a8d214c4f82323}\label{main_8c_ae955c88a2731a99e72a8d214c4f82323} 
int32\+\_\+t {\bfseries pitch\+\_\+true}
\item 
\Hypertarget{main_8c_a9c3df83708b032d87ebd4ebcbe19a309}\label{main_8c_a9c3df83708b032d87ebd4ebcbe19a309} 
int32\+\_\+t {\bfseries yaw\+\_\+true}
\item 
\Hypertarget{main_8c_a581f5ec361f998156bdaacb69894e2e5}\label{main_8c_a581f5ec361f998156bdaacb69894e2e5} 
int32\+\_\+t {\bfseries roll\+\_\+effort}
\item 
\Hypertarget{main_8c_ae1c73004cc7fb7d458f92af71d615db0}\label{main_8c_ae1c73004cc7fb7d458f92af71d615db0} 
int32\+\_\+t {\bfseries pitch\+\_\+effort}
\item 
\Hypertarget{main_8c_ac4510abc73810610befb687e30df131f}\label{main_8c_ac4510abc73810610befb687e30df131f} 
int32\+\_\+t {\bfseries yaw\+\_\+effort}
\item 
\Hypertarget{main_8c_a76c604ed6a7014bf38104c8cd30efa69}\label{main_8c_a76c604ed6a7014bf38104c8cd30efa69} 
int32\+\_\+t {\bfseries roll\+\_\+integral}
\item 
\Hypertarget{main_8c_a6143d6fd2185d0b8c69bc3aa8f52af71}\label{main_8c_a6143d6fd2185d0b8c69bc3aa8f52af71} 
int32\+\_\+t {\bfseries pitch\+\_\+integral}
\item 
\Hypertarget{main_8c_aafe74ae7a645e5858f9a121e18b92903}\label{main_8c_aafe74ae7a645e5858f9a121e18b92903} 
int32\+\_\+t {\bfseries yaw\+\_\+integral}
\item 
\Hypertarget{main_8c_aee0b710d5082d7710ae8bb912e3e85b9}\label{main_8c_aee0b710d5082d7710ae8bb912e3e85b9} 
int32\+\_\+t {\bfseries roll\+\_\+derivative}
\item 
\Hypertarget{main_8c_a82bbdf1008e8b3fae8709c6990889255}\label{main_8c_a82bbdf1008e8b3fae8709c6990889255} 
int32\+\_\+t {\bfseries pitch\+\_\+derivative}
\item 
\Hypertarget{main_8c_a1362c89236de51d2c110ff5328269a90}\label{main_8c_a1362c89236de51d2c110ff5328269a90} 
int32\+\_\+t {\bfseries yaw\+\_\+derivative}
\item 
\Hypertarget{main_8c_a0642ef0bd0dfcf1331470227b0b88a00}\label{main_8c_a0642ef0bd0dfcf1331470227b0b88a00} 
int32\+\_\+t {\bfseries last\+\_\+roll\+\_\+error}
\item 
\Hypertarget{main_8c_ab42ae6d7ffb79a02199026e7dff139d1}\label{main_8c_ab42ae6d7ffb79a02199026e7dff139d1} 
int32\+\_\+t {\bfseries last\+\_\+pitch\+\_\+error}
\item 
\Hypertarget{main_8c_a439f59319cba593da620e1cfacfcd7ff}\label{main_8c_a439f59319cba593da620e1cfacfcd7ff} 
int32\+\_\+t {\bfseries last\+\_\+yaw\+\_\+error}
\item 
\Hypertarget{main_8c_a9f13256ae569556f0127a031ef9d1a3e}\label{main_8c_a9f13256ae569556f0127a031ef9d1a3e} 
int32\+\_\+t {\bfseries last\+\_\+last\+\_\+roll\+\_\+error}
\item 
\Hypertarget{main_8c_ac647c62086589011af40d8489784dcd5}\label{main_8c_ac647c62086589011af40d8489784dcd5} 
int32\+\_\+t {\bfseries last\+\_\+last\+\_\+pitch\+\_\+error}
\item 
\Hypertarget{main_8c_aa6e9274731d4e234b579d5157504a25e}\label{main_8c_aa6e9274731d4e234b579d5157504a25e} 
int32\+\_\+t {\bfseries last\+\_\+last\+\_\+yaw\+\_\+error}
\item 
\Hypertarget{main_8c_ae998977abd5b47ece5b189c7bfd3c63a}\label{main_8c_ae998977abd5b47ece5b189c7bfd3c63a} 
int32\+\_\+t {\bfseries K\+\_\+effort}
\item 
\Hypertarget{main_8c_aab3794e015ef02b4d40a16566641dc95}\label{main_8c_aab3794e015ef02b4d40a16566641dc95} 
int32\+\_\+t {\bfseries Kp\+\_\+roll} = 10
\item 
\Hypertarget{main_8c_a50325de744074c89ef5e15938277467f}\label{main_8c_a50325de744074c89ef5e15938277467f} 
int32\+\_\+t {\bfseries Ki\+\_\+roll} = 0
\item 
\Hypertarget{main_8c_a22552c9e342616880bfc4c5b0e4ebdd9}\label{main_8c_a22552c9e342616880bfc4c5b0e4ebdd9} 
int32\+\_\+t {\bfseries Kd\+\_\+roll} = 0
\item 
\Hypertarget{main_8c_a2976336761f80f142e8c1a16560375af}\label{main_8c_a2976336761f80f142e8c1a16560375af} 
int32\+\_\+t {\bfseries Kp\+\_\+pitch} = 10
\item 
\Hypertarget{main_8c_a465ee9ce8c9d02c6f1c349197778df02}\label{main_8c_a465ee9ce8c9d02c6f1c349197778df02} 
int32\+\_\+t {\bfseries Ki\+\_\+pitch} = 0
\item 
\Hypertarget{main_8c_aba2a84abeed08bbeec34a809da7da9f9}\label{main_8c_aba2a84abeed08bbeec34a809da7da9f9} 
int32\+\_\+t {\bfseries Kd\+\_\+pitch} = 0
\item 
\Hypertarget{main_8c_a58930b9fe46dee03eeda0aa638f3a3a7}\label{main_8c_a58930b9fe46dee03eeda0aa638f3a3a7} 
int32\+\_\+t {\bfseries Kp\+\_\+yaw} =0
\item 
\Hypertarget{main_8c_a9658c8609ab512a1271825d412ab0d58}\label{main_8c_a9658c8609ab512a1271825d412ab0d58} 
int32\+\_\+t {\bfseries Ki\+\_\+yaw} = 0
\item 
\Hypertarget{main_8c_a37fa363923cda7b1579c0839dd91cafb}\label{main_8c_a37fa363923cda7b1579c0839dd91cafb} 
int32\+\_\+t {\bfseries Kd\+\_\+yaw} = 0
\item 
\Hypertarget{main_8c_adbc7f19a8b7c537efc478939fa626457}\label{main_8c_adbc7f19a8b7c537efc478939fa626457} 
uint8\+\_\+t {\bfseries BT\+\_\+\+Rx\+Buf} \mbox{[}BT\+\_\+\+MSG\+\_\+\+LEN\mbox{]}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\+: Main program body for ME507 -\/ MECHA15 -\/ S25 

\begin{DoxyAttention}{Attention}

\end{DoxyAttention}
Copyright (c) 2025 STMicroelectronics. All rights reserved.

This software is licensed under terms that can be found in the LICENSE file in the root directory of this software component. If no LICENSE file comes with this software, it is provided AS-\/\+IS. 

\label{doc-func-members}
\Hypertarget{main_8c_doc-func-members}
\doxysubsection{Function Documentation}
\Hypertarget{main_8c_abc513dd972081ae765b6949a62872eb7}\index{main.c@{main.c}!\_\_io\_putchar@{\_\_io\_putchar}}
\index{\_\_io\_putchar@{\_\_io\_putchar}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{\_\_io\_putchar()}{\_\_io\_putchar()}}
{\footnotesize\ttfamily \label{main_8c_abc513dd972081ae765b6949a62872eb7} 
int \+\_\+\+\_\+io\+\_\+putchar (\begin{DoxyParamCaption}\item[{int}]{ch}{}\end{DoxyParamCaption})}



This function is used to send printf() statments to the ST-\/\+Link UART. 


\begin{DoxyRetVals}{Return values}
{\em None} & \\
\hline
\end{DoxyRetVals}
\Hypertarget{main_8c_a1730ffe1e560465665eb47d9264826f9}\index{main.c@{main.c}!Error\_Handler@{Error\_Handler}}
\index{Error\_Handler@{Error\_Handler}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{Error\_Handler()}{Error\_Handler()}}
{\footnotesize\ttfamily \label{main_8c_a1730ffe1e560465665eb47d9264826f9} 
void Error\+\_\+\+Handler (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



This function is executed in case of error occurrence. 


\begin{DoxyRetVals}{Return values}
{\em None} & \\
\hline
\end{DoxyRetVals}
\Hypertarget{main_8c_ae494a9643f29b87d6d81e5264e60e57b}\index{main.c@{main.c}!HAL\_UART\_RxCpltCallback@{HAL\_UART\_RxCpltCallback}}
\index{HAL\_UART\_RxCpltCallback@{HAL\_UART\_RxCpltCallback}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{HAL\_UART\_RxCpltCallback()}{HAL\_UART\_RxCpltCallback()}}
{\footnotesize\ttfamily \label{main_8c_ae494a9643f29b87d6d81e5264e60e57b} 
void HAL\+\_\+\+UART\+\_\+\+Rx\+Cplt\+Callback (\begin{DoxyParamCaption}\item[{UART\+\_\+\+Handle\+Type\+Def \texorpdfstring{$\ast$}{*}}]{huart}{}\end{DoxyParamCaption})}



This callback function is triggered when UART2 (HC05 Stream) fills BT\+\_\+\+Rx\+Buf (Direct to Memory). It adds an end message statment, sends the buffer to the process\+Input function and sets the imu\+\_\+request flag. 


\begin{DoxyRetVals}{Return values}
{\em None} & \\
\hline
\end{DoxyRetVals}
\Hypertarget{main_8c_a840291bc02cba5474a4cb46a9b9566fe}\index{main.c@{main.c}!main@{main}}
\index{main@{main}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily \label{main_8c_a840291bc02cba5474a4cb46a9b9566fe} 
int main (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



The application entry point. 


\begin{DoxyRetVals}{Return values}
{\em int} & \\
\hline
\end{DoxyRetVals}
\Hypertarget{main_8c_a70af21c671abfcc773614a9a4f63d920}\index{main.c@{main.c}!SystemClock\_Config@{SystemClock\_Config}}
\index{SystemClock\_Config@{SystemClock\_Config}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{SystemClock\_Config()}{SystemClock\_Config()}}
{\footnotesize\ttfamily \label{main_8c_a70af21c671abfcc773614a9a4f63d920} 
void System\+Clock\+\_\+\+Config (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



System Clock Configuration. 


\begin{DoxyRetVals}{Return values}
{\em None} & \\
\hline
\end{DoxyRetVals}
Configure the main internal regulator output voltage

Initializes the RCC Oscillators according to the specified parameters in the RCC\+\_\+\+Osc\+Init\+Type\+Def structure.

Initializes the CPU, AHB and APB buses clocks