<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mechancial Control Systems: Quadcopter (Spring 2025): Inc/HC05.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Gemini_Generated_Image_bgriexbgriexbgri.png"/></td>
  <td id="projectalign">
   <div id="projectname">Mechancial Control Systems: Quadcopter (Spring 2025)
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('_h_c05_8h.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">HC05.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Bluetooth HC-05 module interface for receiving control input.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
</div>
<p><a href="_h_c05_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a83f5acf008b13325bde24f48268f13b9" id="r_a83f5acf008b13325bde24f48268f13b9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a83f5acf008b13325bde24f48268f13b9">processInput</a> (char *charBuf, int32_t *roll, int32_t *pitch, int32_t *yaw, int32_t *effort, int *dumpFlag)</td></tr>
<tr class="memdesc:a83f5acf008b13325bde24f48268f13b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parses input from the HC-05 Bluetooth module.  <br /></td></tr>
<tr class="memitem:a649f4d21cf63078c636631ef6269a882" id="r_a649f4d21cf63078c636631ef6269a882"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a649f4d21cf63078c636631ef6269a882">dumpBlackbox</a> (void)</td></tr>
<tr class="memdesc:a649f4d21cf63078c636631ef6269a882"><td class="mdescLeft">&#160;</td><td class="mdescRight">Outputs the blackbox flight data via UART.  <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Bluetooth HC-05 module interface for receiving control input. </p>
<p>This file contains functions to process incoming UART data and handle blackbox data dumping for debugging purposes.</p>
<dl class="section author"><dt>Author</dt><dd>Aaron </dd></dl>
<dl class="section date"><dt>Date</dt><dd>May 14, 2025 </dd></dl>
</div><a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="a649f4d21cf63078c636631ef6269a882" name="a649f4d21cf63078c636631ef6269a882"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a649f4d21cf63078c636631ef6269a882">&#9670;&#160;</a></span>dumpBlackbox()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dumpBlackbox </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Outputs the blackbox flight data via UART. </p>
<p>This function is used for offline analysis or debugging.</p>
<p>Outputs the blackbox flight data via UART.</p>
<p>Sends all recorded flight data from the blackbox buffer via UART to the connected Bluetooth device. Data is transmitted in CSV format with one sample per line containing pitch, pitch setpoint, roll, and roll setpoint values.</p>
<p>Output format per line: "pitch,pitchSet,roll,rollSet\r\n" All values are in millidegrees.</p>
<dl class="section note"><dt>Note</dt><dd>Function transmits all samples up to current sample_index </dd>
<dd>
200ms delay added to allow receiver to process data </dd>
<dd>
Data transmission is blocking (waits for completion) </dd>
<dd>
Currently only transmits pitch and roll data (yaw commented out)</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Large blackbox buffers may take significant time to transmit </dd>
<dd>
Ensure receiver can handle the data rate </dd>
<dd>
Function blocks until all data is transmitted</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#a83f5acf008b13325bde24f48268f13b9" title="Parses input from the HC-05 Bluetooth module.">processInput()</a> </dd>
<dd>
InitializeBT() </dd></dl>
<p>&lt; Message buffer for each data line</p>

</div>
</div>
<a id="a83f5acf008b13325bde24f48268f13b9" name="a83f5acf008b13325bde24f48268f13b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83f5acf008b13325bde24f48268f13b9">&#9670;&#160;</a></span>processInput()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void processInput </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>charBuf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t *</td>          <td class="paramname"><span class="paramname"><em>roll</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t *</td>          <td class="paramname"><span class="paramname"><em>pitch</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t *</td>          <td class="paramname"><span class="paramname"><em>yaw</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t *</td>          <td class="paramname"><span class="paramname"><em>effort</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>dumpFlag</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parses input from the HC-05 Bluetooth module. </p>
<p>&lt; Standard integer types For printf() debugging </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">charBuf</td><td>Pointer to the received character buffer. </td></tr>
    <tr><td class="paramname">roll</td><td>Pointer to variable storing parsed roll value. </td></tr>
    <tr><td class="paramname">pitch</td><td>Pointer to variable storing parsed pitch value. </td></tr>
    <tr><td class="paramname">yaw</td><td>Pointer to variable storing parsed yaw value. </td></tr>
    <tr><td class="paramname">effort</td><td>Pointer to variable storing parsed throttle/effort value. </td></tr>
    <tr><td class="paramname">dumpFlag</td><td>Pointer to a flag indicating whether to dump blackbox data.</td></tr>
  </table>
  </dd>
</dl>
<p>Parses input from the HC-05 Bluetooth module.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">charBuf</td><td>Input string buffer containing control data </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">roll</td><td>Pointer to store calculated roll setpoint (millidegrees) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pitch</td><td>Pointer to store calculated pitch setpoint (millidegrees) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">yaw</td><td>Pointer to store calculated yaw setpoint (millidegrees) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">effort</td><td>Pointer to store/update throttle effort value </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">dumpFlag</td><td>Pointer to store blackbox dump request flag</td></tr>
  </table>
  </dd>
</dl>
<p>Parses comma-separated joystick and button data from the control device. Expected input format: "#LjoyX,LjoyY,RjoyX,LT,RT,ENTER"</p>
<p>Control mapping:</p><ul>
<li>Left joystick X/Y → Roll/Pitch commands (±20° range)</li>
<li>Right joystick X → Yaw rate command (relative to current heading)</li>
<li>Left/Right triggers → Throttle increase/decrease</li>
<li>Enter button → Trigger blackbox data dump</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Input must start with '#' character for validation </dd>
<dd>
Roll/Pitch scaled from joystick ±1000 range to ±20° (±20000 millidegrees) </dd>
<dd>
Yaw command is relative to current heading with wraparound </dd>
<dd>
Effort is constrained between 0 and 1000, 0 is transformed to large negative number, ensuring no spin due to PID loop </dd>
<dd>
Invalid inputs increment badBTcount and are rejected</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Pointers must be valid and point to allocated memory </dd>
<dd>
Function modifies input buffer (uses strtok)</dd></dl>
<dl class="section see"><dt>See also</dt><dd>InitializeBT() </dd>
<dd>
<a class="el" href="#a649f4d21cf63078c636631ef6269a882" title="Outputs the blackbox flight data via UART.">dumpBlackbox()</a> </dd></dl>
<p>&lt; Parsed joystick and button values</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_f93dfce691d792349f1c14ede440e2e6.html">Inc</a></li><li class="navelem"><a href="_h_c05_8h.html">HC05.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
